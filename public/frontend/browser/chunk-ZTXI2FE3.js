import{A as o,Ac as p,Fc as l,L as c,P as a,S as h,W as u,o as i,s as n}from"./chunk-Y5CYITTI.js";var g=class d{constructor(e){this.http=e}apiUrl=`${l.apiUrl}/students`;cache$;getStudents(){return this.cache$||(this.cache$=this.http.get(`${this.apiUrl}`).pipe(a(e=>{console.log("\u{1F4E1} Raw API Response:",e),e.success&&e.data&&(console.log("\u2705 Students count:",e.data.length),e.data.forEach(t=>{console.log(`\u{1F464} ${t.fullName}: training=${t.trainingCountThisMonth||0}`)}))}),n(e=>!e.success||!e.data?(console.warn("\u26A0\uFE0F Invalid response format:",e),[]):e.data),c(1),o(this.handleError))),this.cache$}refreshCache(){console.log("\u{1F504} Clearing students cache..."),this.cache$=void 0}getStudentById(e){return this.http.get(`${this.apiUrl}/${e}`).pipe(n(t=>{if(!t.success||!t.data)throw new Error(t.message||"Student not found");return t.data}),o(this.handleError))}createStudent(e){return console.log("\u{1F4DD} Creating student:",e),this.http.post(`${this.apiUrl}`,e).pipe(a(t=>console.log("\u{1F4E1} Create response:",t)),n(t=>{if(console.log("\u2705 Response success:",t.success),console.log("\u2705 Response data:",t.data),!t.success||!t.data)throw new Error(t.message||"Failed to create student");return this.refreshCache(),t.data}),o(t=>(console.error("\u274C Error creating student:",t),this.handleError(t))))}updateStudent(e,t){return console.log("\u270F\uFE0F Updating student:",e),this.http.put(`${this.apiUrl}/${e}`,t).pipe(a(r=>console.log("\u{1F4E1} Update response:",r)),n(r=>{if(!r.success||!r.data)throw new Error(r.message||"Failed to update student");return this.refreshCache(),r.data}),o(r=>(console.error("\u274C Error updating student:",r),this.handleError(r))))}deleteStudent(e){return console.log("\u{1F5D1}\uFE0F Deleting student:",e),this.http.delete(`${this.apiUrl}/${e}`).pipe(a(()=>{console.log("\u2705 Student deleted"),this.refreshCache()}),n(()=>{}),o(t=>(console.error("\u274C Error deleting student:",t),this.handleError(t))))}uploadPhoto(e,t){console.log("\u{1F4F8} Uploading photo for student:",e);let r=new FormData;return r.append("photo",t),this.http.post(`${this.apiUrl}/${e}/photo`,r).pipe(a(s=>console.log("\u{1F4E1} Upload response:",s)),n(s=>{if(console.log("\u2705 Photo upload success:",s.success),!s.success||!s.data)throw new Error(s.message||"Failed to upload photo");return this.refreshCache(),s.data}),o(s=>(console.error("\u274C Error uploading photo:",s),this.handleError(s))))}deletePhoto(e){return console.log("\u{1F5D1}\uFE0F Deleting photo for student:",e),this.http.delete(`${this.apiUrl}/${e}/photo`).pipe(a(t=>console.log("\u{1F4E1} Delete photo response:",t)),n(t=>{if(!t.success||!t.data)throw new Error(t.message||"Failed to delete photo");return this.refreshCache(),t.data}),o(t=>(console.error("\u274C Error deleting photo:",t),this.handleError(t))))}searchStudents(e){return console.log("\u{1F50D} Searching students:",e),this.http.get(`${this.apiUrl}/search?q=${e}`).pipe(n(t=>t.success&&t.data?t.data:[]),o(this.handleError))}filterByStatus(e){return this.http.get(`${this.apiUrl}/filter?status=${e}`).pipe(n(t=>t.success&&t.data?t.data:[]),o(this.handleError))}getStudentsByDay(e){return this.http.get(`${this.apiUrl}/by-day?day=${e}`).pipe(n(t=>t.success&&t.data?t.data:[]),o(this.handleError))}getStudentsByProgram(e){return this.http.get(`${this.apiUrl}/by-program?program=${e}`).pipe(n(t=>t.success&&t.data?t.data:[]),o(this.handleError))}getOverduePayments(e=30){return this.http.get(`${this.apiUrl}/overdue-payments?days=${e}`).pipe(n(t=>t.success&&t.data?t.data:[]),o(this.handleError))}getTrainingCountThisMonth(e){return console.log("\u{1F4CA} Getting training count for:",e),this.http.get(`${this.apiUrl}/${e}/training-count`).pipe(a(t=>console.log("\u{1F4E1} Count response:",t)),n(t=>t.success&&t.data?(console.log("\u2705 Training count:",t.data.count),t.data.count||0):0),o(t=>(console.error("\u274C Error getting training count:",t),i(()=>new Error("Failed to get training count")))))}resetTrainingCount(e){return console.log("\u{1F504} Resetting training count for:",e),this.http.post(`${this.apiUrl}/${e}/reset-training-count`,{}).pipe(a(t=>console.log("\u{1F4E1} Reset response:",t)),n(t=>{if(!t.success)throw new Error(t.message||"Failed to reset training count");return this.refreshCache(),t.data}),o(t=>(console.error("\u274C Error resetting training count:",t),this.handleError(t))))}getPaymentsByStudentId(e){return console.log("\u{1F4B3} Getting payments for:",e),this.http.get(`${this.apiUrl}/${e}/payments`).pipe(a(t=>console.log("\u{1F4E1} Payments response:",t)),n(t=>t.success&&t.data?t.data:[]),o(t=>(console.error("\u274C Error getting payments:",t),i(()=>new Error("Failed to get payments")))))}addPaymentToCollection(e){return console.log("\u{1F4B3} Adding payment:",e),this.http.post(`${l.apiUrl}/payments`,e).pipe(a(t=>console.log("\u{1F4E1} Payment added:",t)),n(t=>{if(!t.success)throw new Error(t.message||"Failed to add payment");return t.data}),o(t=>(console.error("\u274C Error adding payment:",t),this.handleError(t))))}deletePaymentFromCollection(e){return console.log("\u{1F5D1}\uFE0F Deleting payment:",e),this.http.delete(`${l.apiUrl}/payments/${e}`).pipe(a(()=>console.log("\u2705 Payment deleted")),n(()=>{}),o(t=>(console.error("\u274C Error deleting payment:",t),this.handleError(t))))}sendPaymentReminder(e,t){return console.log("\u{1F4F1} Sending reminder to:",e),this.http.post(`${this.apiUrl}/${e}/send-reminder`,t).pipe(a(r=>console.log("\u{1F4E1} Reminder response:",r)),n(r=>{if(!r.success)throw new Error(r.message||"Failed to send reminder");return r.data}),o(r=>(console.error("\u274C Error sending reminder:",r),this.handleError(r))))}handleError(e){let t="An error occurred";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:(console.error(`Backend returned code ${e.status}`),console.error("Body:",e.error),e.status===0?t="Unable to connect to server. Please check if the backend is running.":e.error&&e.error.message?t=e.error.message:e.error&&e.error.error?t=e.error.error:t=`Server Error: ${e.status} - ${e.statusText}`),console.error("\u274C HTTP Error:",t),i(()=>new Error(t))}static \u0275fac=function(t){return new(t||d)(u(p))};static \u0275prov=h({token:d,factory:d.\u0275fac,providedIn:"root"})};export{g as a};
