import{A as s,L as p,P as a,S as c,W as u,n as i,o as d,s as n,tc as m,yc as h}from"./chunk-I6WMCBKH.js";var g=class l{constructor(t){this.http=t}apiUrl=`${h.apiUrl}/students`;paymentsApiUrl=`${h.apiUrl}/payments`;cache$;getStudents(){return this.cache$||(this.cache$=this.http.get(this.apiUrl).pipe(n(t=>(console.log("\u{1F4E1} API Response:",t),t.success&&t.data?t.data:[])),p(1),s(this.handleError))),this.cache$}getStudentById(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(n(e=>{if(!e.success||!e.data)throw new Error("Student not found");return e.data}),s(this.handleError))}createStudent(t){return this.http.post(this.apiUrl,t).pipe(n(e=>{if(!e.success||!e.data)throw new Error(e.message||"Failed to create student");return this.refreshCache(),e.data}),s(this.handleError))}updateStudent(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(n(r=>{if(!r.success||!r.data)throw new Error(r.message||"Failed to update student");return this.refreshCache(),r.data}),s(this.handleError))}deleteStudent(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(a(()=>this.refreshCache()),n(()=>{}),s(this.handleError))}uploadPhoto(t,e){console.log("\u{1F527} Uploading photo for student:",t);let r=new FormData;return r.append("photo",e),this.http.post(`${this.apiUrl}/${t}/photo`,r).pipe(n(o=>{if(console.log("\u2705 Upload response:",o),!o.success||!o.data)throw new Error(o.message||"Failed to upload photo");return this.refreshCache(),o.data}),a(o=>{console.log("\u2705 Photo path:",o.photo)}),s(this.handleError))}deletePhoto(t){return this.http.delete(`${this.apiUrl}/${t}/photo`).pipe(n(e=>{if(!e.success||!e.data)throw new Error(e.message||"Failed to delete photo");return this.refreshCache(),e.data}),s(this.handleError))}getOverduePayments(){let t=`${this.apiUrl}/overdue-payments`;return console.log("\u{1F4DE} Calling overdue payments:",t),this.http.get(t).pipe(n(e=>(console.log("\u2705 Overdue payments response:",e),e.success&&e.data?e.data:[])),a(e=>console.log(`Found ${e.length} overdue payments`)),s(e=>(console.error("\u274C Error fetching overdue payments:",e),i([]))))}getUpcomingPayments(){let t=`${this.apiUrl}/upcoming-payments`;return console.log("\u{1F4DE} Calling upcoming payments:",t),this.http.get(t).pipe(n(e=>(console.log("\u2705 Upcoming payments response:",e),e.success&&e.data?e.data:[])),a(e=>console.log(`Found ${e.length} upcoming payments`)),s(e=>(console.error("\u274C Error fetching upcoming payments:",e),i([]))))}addMonthlyPayment(t,e){return console.log("\u{1F4B3} Adding payment for student:",t,e),this.http.post(this.paymentsApiUrl,e).pipe(n(r=>{if(!r.success||!r.data)throw new Error(r.message||"Failed to add payment");return this.refreshCache(),r.data}),a(r=>{console.log("\u2705 Payment added:",r)}),s(this.handleError))}getPaymentHistory(t){console.log("\u{1F4CB} Fetching payment history for:",t);let e=`${this.paymentsApiUrl}/student/${t}`;return this.http.get(e).pipe(n(r=>(console.log("\u2705 Payment history response:",r),r.success&&r.data?r.data:[])),a(r=>console.log(`Found ${r.length} payment records`)),s(r=>(console.error("\u274C Error fetching payment history:",r),i([]))))}getAllPayments(t){let e=this.paymentsApiUrl,r=[];return t?.month&&r.push(`month=${t.month}`),t?.status&&r.push(`status=${t.status}`),r.length>0&&(e+=`?${r.join("&")}`),console.log("\u{1F4CB} Fetching all payments:",e),this.http.get(e).pipe(n(o=>o.success&&o.data?o.data:[]),s(o=>(console.error("\u274C Error fetching all payments:",o),i([]))))}deletePayment(t){return this.http.delete(`${this.paymentsApiUrl}/${t}`).pipe(a(()=>{console.log("\u2705 Payment deleted:",t),this.refreshCache()}),n(()=>{}),s(this.handleError))}sendPaymentReminder(t){return this.http.post(`${this.apiUrl}/${t}/remind`,{}).pipe(n(e=>{if(!e.success)throw new Error(e.message||"Failed to send reminder");return e}),a(()=>console.log("\u2705 Payment reminder sent to:",t)),s(this.handleError))}refreshCache(){console.log("\u{1F504} Clearing cache..."),this.cache$=void 0}clearCache(){this.refreshCache()}handleError(t){let e="An error occurred";return t.error instanceof ErrorEvent?e=`Error: ${t.error.message}`:(console.error(`Backend returned code ${t.status}`),console.error("Body:",t.error),t.status===0?e="Unable to connect to server. Please check if the backend is running.":t.error&&t.error.message?e=t.error.message:t.status===404?e="Resource not found":t.status===400?e="Bad request. Please check your input.":e=`Server Error: ${t.status} - ${t.statusText}`),console.error("\u274C HTTP Error:",e),d(()=>new Error(e))}static \u0275fac=function(e){return new(e||l)(u(m))};static \u0275prov=c({token:l,factory:l.\u0275fac,providedIn:"root"})};export{g as a};
