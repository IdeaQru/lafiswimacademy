import './polyfills.server.mjs';
import{a as d}from"./chunk-2MWTOOCD.mjs";import{K as a,N as E,Qc as S,R as m,Rc as b,g as c,k as l,o as s,w as n}from"./chunk-MQOS27Y4.mjs";var f=class g{constructor(t){this.http=t;console.log("\u{1F4DA} [STUDENT SERVICE] Initialized")}apiUrl=`${d.apiUrl}/students`;refreshSubject=new c(void 0);refresh$=this.refreshSubject.asObservable();getStudents(t=1,e=10,r="Semua",i="",u="createdAt",p="desc"){console.log("\u{1F4CB} [STUDENT SERVICE] Getting students with pagination:",{page:t,limit:e,status:r,search:i,sortBy:u,order:p});let o=new S().set("page",t.toString()).set("limit",e.toString()).set("sortBy",u).set("order",p);return r&&r!=="Semua"&&(o=o.set("status",r)),i&&i.trim()&&(o=o.set("search",i.trim())),this.http.get(this.apiUrl,{params:o}).pipe(a(h=>{console.log("\u{1F4E1} Students response:",{count:h.data?.length||0,pagination:h.pagination})}),n(this.handleError))}getStudentById(t){return console.log("\u{1F464} [STUDENT SERVICE] Getting student:",t),this.http.get(`${this.apiUrl}/${t}`).pipe(s(e=>{if(!e.success||!e.data)throw new Error(e.message||"Student not found");return e.data}),n(this.handleError))}createStudent(t){return console.log("\u{1F4DD} [STUDENT SERVICE] Creating student:",t.fullName),this.http.post(this.apiUrl,t).pipe(a(e=>{console.log("\u2705 Student created:",e.data),this.triggerRefresh()}),s(e=>{if(!e.success||!e.data)throw new Error(e.message||"Failed to create student");return e.data}),n(this.handleError))}updateStudent(t,e){return console.log("\u270F\uFE0F [STUDENT SERVICE] Updating student:",t),this.http.put(`${this.apiUrl}/${t}`,e).pipe(a(r=>{console.log("\u2705 Student updated:",r.data),this.triggerRefresh()}),s(r=>{if(!r.success||!r.data)throw new Error(r.message||"Failed to update student");return r.data}),n(this.handleError))}deleteStudent(t){return console.log("\u{1F5D1}\uFE0F [STUDENT SERVICE] Deleting student:",t),this.http.delete(`${this.apiUrl}/${t}`).pipe(a(()=>{console.log("\u2705 Student deleted"),this.triggerRefresh()}),s(()=>{}),n(this.handleError))}uploadPhoto(t,e){console.log("\u{1F4F8} [STUDENT SERVICE] Uploading photo for:",t);let r=new FormData;return r.append("photo",e),this.http.post(`${this.apiUrl}/${t}/photo`,r).pipe(a(i=>{console.log("\u2705 Photo uploaded"),this.triggerRefresh()}),s(i=>{if(!i.success||!i.data)throw new Error(i.message||"Failed to upload photo");return i.data}),n(this.handleError))}deletePhoto(t){return console.log("\u{1F5D1}\uFE0F [STUDENT SERVICE] Deleting photo for:",t),this.http.delete(`${this.apiUrl}/${t}/photo`).pipe(a(e=>{console.log("\u2705 Photo deleted"),this.triggerRefresh()}),s(e=>{if(!e.success||!e.data)throw new Error(e.message||"Failed to delete photo");return e.data}),n(this.handleError))}searchStudents(t){return!t||t.trim().length<2?l(()=>new Error("Search query must be at least 2 characters")):(console.log("\u{1F50D} [STUDENT SERVICE] Searching:",t),this.http.get(`${this.apiUrl}/search`,{params:{q:t.trim()}}).pipe(s(e=>e.success&&e.data?e.data:[]),n(this.handleError)))}filterByStatus(t){return console.log("\u{1F50D} [STUDENT SERVICE] Filtering by status:",t),this.http.get(`${this.apiUrl}/filter`,{params:{status:t}}).pipe(s(e=>e.success&&e.data?e.data:[]),n(this.handleError))}getStudentStats(){return console.log("\u{1F4CA} [STUDENT SERVICE] Getting statistics"),this.http.get(`${this.apiUrl}/stats`).pipe(s(t=>t.success&&t.data?t.data:null),n(this.handleError))}getTrainingCountThisMonth(t){return console.log("\u{1F4CA} [STUDENT SERVICE] Getting training count:",t),this.http.get(`${this.apiUrl}/${t}/training-count`).pipe(s(e=>e.success&&e.data&&e.data.count||0),n(()=>(console.warn("\u26A0\uFE0F Failed to get training count, returning 0"),l(()=>new Error("Failed to get training count")))))}resetTrainingCount(t){return console.log("\u{1F504} [STUDENT SERVICE] Resetting training count:",t),this.http.post(`${this.apiUrl}/${t}/reset-training-count`,{}).pipe(a(()=>{console.log("\u2705 Training count reset"),this.triggerRefresh()}),s(e=>{if(!e.success)throw new Error(e.message||"Failed to reset training count");return e.data}),n(this.handleError))}getPaymentsByStudentId(t){return console.log("\u{1F4B3} [STUDENT SERVICE] Getting payments:",t),this.http.get(`${this.apiUrl}/${t}/payments`).pipe(s(e=>e.success&&e.data?e.data:[]),n(e=>(console.error("\u274C Error getting payments:",e),l(()=>new Error("Failed to get payments")))))}getAllStudentsSimple(){return console.log("\u{1F4CB} [STUDENT SERVICE] Getting all students (simple list)"),this.getStudents(1,1e3,"Aktif","","fullName","asc").pipe(s(t=>t.data||[]),a(t=>{console.log(`\u2705 Loaded ${t.length} students (simple)`)}),n(this.handleError))}addPaymentToCollection(t){return console.log("\u{1F4B3} [STUDENT SERVICE] Adding payment:",t),this.http.post(`${d.apiUrl}/payments`,t).pipe(a(()=>{console.log("\u2705 Payment added"),this.triggerRefresh()}),s(e=>{if(!e.success)throw new Error(e.message||"Failed to add payment");return e.data}),n(this.handleError))}deletePaymentFromCollection(t){return console.log("\u{1F5D1}\uFE0F [STUDENT SERVICE] Deleting payment:",t),this.http.delete(`${d.apiUrl}/payments/${t}`).pipe(a(()=>{console.log("\u2705 Payment deleted"),this.triggerRefresh()}),s(()=>{}),n(this.handleError))}sendPaymentReminder(t,e){return console.log("\u{1F4F1} [STUDENT SERVICE] Sending reminder:",t),this.http.post(`${this.apiUrl}/${t}/send-reminder`,e).pipe(a(r=>{console.log("\u2705 Reminder sent:",r)}),s(r=>{if(!r.success)throw new Error(r.message||"Failed to send reminder");return r.data}),n(this.handleError))}triggerRefresh(){console.log("\u{1F504} [STUDENT SERVICE] Triggering refresh"),this.refreshSubject.next()}handleError(t){let e="An error occurred";return t.error instanceof ErrorEvent?e=`Error: ${t.error.message}`:(console.error("\u274C Backend error:",{status:t.status,statusText:t.statusText,body:t.error}),t.status===0?e="Unable to connect to server. Please check if the backend is running.":t.error?.message?e=t.error.message:t.error?.error?e=t.error.error:e=`Server Error: ${t.status} - ${t.statusText}`),console.error("\u274C [STUDENT SERVICE] Error:",e),l(()=>new Error(e))}static \u0275fac=function(e){return new(e||g)(m(b))};static \u0275prov=E({token:g,factory:g.\u0275fac,providedIn:"root"})};export{f as a};
