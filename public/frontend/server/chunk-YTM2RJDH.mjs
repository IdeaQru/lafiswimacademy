import './polyfills.server.mjs';
import{j as g}from"./chunk-7LP3QF2G.mjs";import{a as h}from"./chunk-2MWTOOCD.mjs";import{Hc as u,Lc as c,O as a,S as o,ga as s,n,qa as l}from"./chunk-4IZXVEIU.mjs";var m=class i{constructor(t,r,e){this.http=t;this.router=r;this.platformId=e;this.isBrowser=u(this.platformId),this.isBrowser&&this.checkAuth()}apiUrl=`${h.apiUrl}/auth`;isBrowser;currentUser=s(null);isAuthenticated=s(!1);token=s(null);error=s(null);loading=s(!1);checkAuth(){if(this.isBrowser)try{let t=localStorage.getItem("token"),r=localStorage.getItem("user");if(console.log("\u{1F50D} AuthService checkAuth:",{hasToken:!!t,hasUser:!!r}),t&&r){let e=JSON.parse(r);this.token.set(t),this.currentUser.set(e),this.isAuthenticated.set(!0),console.log("\u2705 Auth state restored:",e.username)}else console.log("\u274C No auth data in localStorage")}catch(t){console.error("\u274C Failed to restore auth state:",t),this.clearAuth()}}syncAuthState(){if(this.isBrowser)try{let t=localStorage.getItem("token"),r=localStorage.getItem("user");if(t&&r){let e=JSON.parse(r);this.token.set(t),this.currentUser.set(e),this.isAuthenticated.set(!0),console.log("\u{1F504} Auth state synced")}}catch(t){console.error("Failed to sync auth state:",t),this.clearAuth()}}async login(t,r){try{this.loading.set(!0),this.error.set(null);let e=await n(this.http.post(`${this.apiUrl}/login`,{username:t,password:r}));return e.success&&e.data&&(this.isBrowser&&(localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user))),this.token.set(e.data.token),this.currentUser.set(e.data.user),this.isAuthenticated.set(!0),console.log("\u2705 Login successful:",e.data.user.username)),this.loading.set(!1),e}catch(e){throw this.loading.set(!1),this.error.set(e.error?.message||"Login failed"),console.error("\u274C Login failed:",e),e}}logout(){this.clearAuth(),this.router.navigate(["/"]),console.log("\u{1F44B} Logged out")}clearAuth(){this.isBrowser&&(localStorage.removeItem("token"),localStorage.removeItem("user")),this.token.set(null),this.currentUser.set(null),this.isAuthenticated.set(!1)}getToken(){return this.token()}getUser(){return this.currentUser()}isLoggedIn(){return this.isAuthenticated()}isBrowserPlatform(){return this.isBrowser}static \u0275fac=function(r){return new(r||i)(o(c),o(g),o(l))};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
